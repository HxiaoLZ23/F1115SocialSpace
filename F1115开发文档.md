# F1115 社交媒体平台开发文档

## 文档版本
- **版本**: v1.0
- **创建日期**: 2026-01-16
- **最后更新**: 2026-01-16
- **开发环境**: VSCode (AI编程) / IDEA (部分操作)

---

## 目录

1. [项目概述](#1-项目概述)
2. [技术栈选择](#2-技术栈选择)
3. [系统架构设计](#3-系统架构设计)
4. [数据库设计](#4-数据库设计)
5. [功能模块划分](#5-功能模块划分)
6. [API接口设计](#6-api接口设计)
7. [开发阶段规划](#7-开发阶段规划)
8. [AI机器人集成方案](#8-ai机器人集成方案)
9. [部署方案](#9-部署方案)
10. [技术细节与注意事项](#10-技术细节与注意事项)

---

## 1. 项目概述

### 1.1 项目简介
**F1115** 是一个社交媒体平台，支持用户发帖、评论、点赞、关注等核心功能，并集成AI机器人实现内容生成和审核。

### 1.2 项目目标
- **主平台**: 用户社交功能（注册、登录、发帖、评论、点赞、关注）
- **管理平台**: 基于现有CRM系统重构，实现用户和内容管理
- **AI机器人**: 自主发帖/评论、内容审核

### 1.3 核心功能
- 用户系统：注册、登录、个人主页
- 内容系统：发帖、评论、点赞
- 社交系统：关注、粉丝列表
- 管理后台：用户管理、内容审核、数据统计
- AI功能：内容生成、违规检测

---

## 2. 技术栈选择

### 2.1 后端技术栈
| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| Java | 1.8+ | 开发语言 | 保持与现有项目一致 |
| Spring Framework | 5.3.4 | IOC/AOP | 核心框架 |
| Spring MVC | 5.3.4 | Web框架 | RESTful API |
| MyBatis | 3.5.7 | ORM框架 | 数据库操作 |
| MySQL | 5.7+ / 8.0+ | 数据库 | 推荐8.0 |
| PageHelper | 5.2.0 | 分页插件 | 分页查询 |
| Lombok | 1.18.20 | 代码简化 | 减少样板代码 |
| Jackson | 2.12.5 | JSON处理 | 序列化/反序列化 |
| Druid | 1.2.8 | 连接池 | 数据库连接池 |
| Hutool | 5.7.11 | 工具类库 | 工具函数 |
| Hibernate Validator | 6.2.3 | 参数校验 | 数据验证 |

### 2.2 前端技术栈
| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| Vue.js | 2.x / 3.x | 前端框架 | 推荐3.x |
| Element UI / Plus | 2.x / 3.x | UI组件库 | 根据Vue版本选择 |
| Axios | 最新版 | HTTP客户端 | API请求 |
| Vue Router | 最新版 | 路由管理 | 单页应用路由 |
| Vuex / Pinia | - | 状态管理 | 全局状态（可选） |

### 2.3 AI集成技术栈
| 技术 | 用途 | 说明 |
|------|------|------|
| DashScope API | AI对话 | 内容生成 |
| Spring Scheduled | 定时任务 | AI定时发帖 |
| Java HTTP Client | API调用 | 调用AI服务 |
| Redis (可选) | 缓存/队列 | 消息队列、缓存 |

### 2.4 部署技术栈
| 技术 | 用途 | 说明 |
|------|------|------|
| Tomcat | 9.0+ | 应用服务器 | WAR包部署 |
| Nginx | 最新版 | 反向代理 | 负载均衡、静态资源 |
| Maven | 3.6+ | 构建工具 | 项目构建 |

### 2.5 可选技术（根据需求）
- **Redis**: 缓存、Session存储、消息队列
- **Elasticsearch**: 全文搜索（帖子搜索）
- **WebSocket**: 实时通知（点赞、评论通知）
- **MinIO / OSS**: 文件存储（图片、视频）
- **RabbitMQ / Kafka**: 消息队列（AI任务、通知）

---

## 3. 系统架构设计

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │   Web前端    │  │   移动端H5   │  │   管理后台   │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      Nginx反向代理                            │
│              (负载均衡、静态资源、SSL)                         │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      应用服务层                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Spring MVC (RESTful API)               │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐         │   │
│  │  │  Controller │ │  Service │ │   Mapper  │         │   │
│  │  └──────────┘  └──────────┘  └──────────┘         │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              AI服务模块                              │   │
│  │  • 内容生成服务  • 内容审核服务  • 定时任务          │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据持久层                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │    MySQL     │  │   Redis      │  │   文件存储   │     │
│  │  (主数据)    │  │  (缓存)      │  │  (图片/视频) │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 模块划分

```
f1115-platform/
├── f1115-main/          # 主平台模块（用户端）
│   ├── controller/      # 主平台控制器
│   ├── service/         # 业务逻辑
│   ├── mapper/          # 数据访问
│   └── dto/             # 数据传输对象
├── f1115-admin/         # 管理平台模块（基于现有CRM重构）
│   ├── controller/      # 管理端控制器
│   ├── service/         # 管理业务逻辑
│   └── ...
├── f1115-ai/            # AI服务模块
│   ├── service/         # AI业务逻辑
│   ├── scheduler/       # 定时任务
│   └── client/          # AI API客户端
├── f1115-common/        # 公共模块
│   ├── domain/          # 实体类
│   ├── dto/             # 公共DTO
│   ├── utils/           # 工具类
│   └── config/          # 配置类
└── f1115-api/           # API接口定义（可选）
```

### 3.3 数据库架构

- **主数据库**: MySQL（用户、帖子、评论、点赞、关注等）
- **缓存层**: Redis（热点数据、Session、计数器）
- **文件存储**: 本地存储 / OSS（图片、视频）

---

## 4. 数据库设计

### 4.1 数据库命名规范
- **数据库名**: `f1115_db`
- **表名**: 小写+下划线，如 `user_profile`, `post`, `comment`
- **字段名**: 小写+下划线，如 `user_id`, `create_time`

### 4.2 核心表结构设计

#### 4.2.1 用户相关表

**表1: user_profile (用户信息表)**
```sql
CREATE TABLE `user_profile` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` VARCHAR(50) NOT NULL COMMENT '用户名（唯一）',
  `password` VARCHAR(255) NOT NULL COMMENT '密码（MD5加密）',
  `nickname` VARCHAR(50) DEFAULT NULL COMMENT '昵称',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
  `email` VARCHAR(100) DEFAULT NULL COMMENT '邮箱',
  `bio` VARCHAR(500) DEFAULT NULL COMMENT '个人简介',
  `status` TINYINT(1) DEFAULT 1 COMMENT '状态：0-禁用 1-正常',
  `role` TINYINT(1) DEFAULT 0 COMMENT '角色：0-普通用户 1-管理员',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户信息表';
```

**表2: follow_relation (关注关系表)**
```sql
CREATE TABLE `follow_relation` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `follower_id` BIGINT(20) NOT NULL COMMENT '关注者ID',
  `following_id` BIGINT(20) NOT NULL COMMENT '被关注者ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '关注时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_follow` (`follower_id`, `following_id`),
  KEY `idx_follower` (`follower_id`),
  KEY `idx_following` (`following_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='关注关系表';
```

#### 4.2.2 内容相关表

**表3: post (帖子表)**
```sql
CREATE TABLE `post` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '帖子ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '发布者ID',
  `content` TEXT NOT NULL COMMENT '帖子内容',
  `images` JSON DEFAULT NULL COMMENT '图片列表（JSON数组）',
  `type` TINYINT(1) DEFAULT 0 COMMENT '类型：0-普通 1-置顶 2-AI生成',
  `status` TINYINT(1) DEFAULT 1 COMMENT '状态：0-删除 1-正常 2-审核中 3-违规',
  `like_count` INT(11) DEFAULT 0 COMMENT '点赞数',
  `comment_count` INT(11) DEFAULT 0 COMMENT '评论数',
  `view_count` INT(11) DEFAULT 0 COMMENT '浏览量',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '发布时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='帖子表';
```

**表4: comment (评论表)**
```sql
CREATE TABLE `comment` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '评论ID',
  `post_id` BIGINT(20) NOT NULL COMMENT '帖子ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '评论者ID',
  `parent_id` BIGINT(20) DEFAULT NULL COMMENT '父评论ID（回复时使用）',
  `content` TEXT NOT NULL COMMENT '评论内容',
  `like_count` INT(11) DEFAULT 0 COMMENT '点赞数',
  `status` TINYINT(1) DEFAULT 1 COMMENT '状态：0-删除 1-正常 2-审核中 3-违规',
  `type` TINYINT(1) DEFAULT 0 COMMENT '类型：0-普通 1-AI生成',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '评论时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_post_id` (`post_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';
```

**表5: post_like (帖子点赞表)**
```sql
CREATE TABLE `post_like` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `post_id` BIGINT(20) NOT NULL COMMENT '帖子ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '点赞用户ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '点赞时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_post_user` (`post_id`, `user_id`),
  KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='帖子点赞表';
```

**表6: comment_like (评论点赞表)**
```sql
CREATE TABLE `comment_like` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `comment_id` BIGINT(20) NOT NULL COMMENT '评论ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '点赞用户ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '点赞时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_comment_user` (`comment_id`, `user_id`),
  KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论点赞表';
```

#### 4.2.3 AI相关表

**表7: ai_robot (AI机器人配置表)**
```sql
CREATE TABLE `ai_robot` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '机器人ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '关联用户ID',
  `name` VARCHAR(50) NOT NULL COMMENT '机器人名称',
  `api_key` VARCHAR(255) DEFAULT NULL COMMENT 'API密钥（加密存储）',
  `model` VARCHAR(50) DEFAULT 'gpt-3.5-turbo' COMMENT '模型类型',
  `status` TINYINT(1) DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `config` JSON DEFAULT NULL COMMENT '配置信息（JSON）',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='AI机器人配置表';
```

**表8: content_audit (内容审核记录表)**
```sql
CREATE TABLE `content_audit` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `content_type` TINYINT(1) NOT NULL COMMENT '内容类型：1-帖子 2-评论',
  `content_id` BIGINT(20) NOT NULL COMMENT '内容ID',
  `audit_status` TINYINT(1) DEFAULT 2 COMMENT '审核状态：0-通过 1-拒绝 2-待审核',
  `audit_result` VARCHAR(500) DEFAULT NULL COMMENT '审核结果说明',
  `auditor_id` BIGINT(20) DEFAULT NULL COMMENT '审核者ID（AI或管理员）',
  `audit_type` TINYINT(1) DEFAULT 0 COMMENT '审核类型：0-自动 1-人工',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '审核时间',
  PRIMARY KEY (`id`),
  KEY `idx_content` (`content_type`, `content_id`),
  KEY `idx_audit_status` (`audit_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='内容审核记录表';
```

### 4.3 数据库设计图

```
┌──────────────┐         ┌──────────────┐
│ user_profile │         │ follow_relation│
│   (用户信息)  │◄────────┤   (关注关系)  │
└──────────────┘         └──────────────┘
       │
       │ 1:N
       ▼
┌──────────────┐         ┌──────────────┐
│     post     │         │   comment    │
│    (帖子)    │◄────────┤   (评论)     │
└──────────────┘         └──────────────┘
       │                         │
       │                         │
       ▼                         ▼
┌──────────────┐         ┌──────────────┐
│  post_like   │         │ comment_like │
│  (帖子点赞)  │         │  (评论点赞)  │
└──────────────┘         └──────────────┘

┌──────────────┐         ┌──────────────┐
│  ai_robot    │         │content_audit │
│ (AI机器人)   │         │  (内容审核)  │
└──────────────┘         └──────────────┘
```

---

## 5. 功能模块划分

### 5.1 主平台模块 (f1115-main)

#### 5.1.1 用户模块
- **注册功能**
  - 用户名、密码、邮箱注册
  - 验证码校验
  - 密码加密存储（MD5）
  
- **登录功能**
  - 用户名/邮箱登录
  - Session管理
  - 登录状态保持
  
- **个人主页**
  - 用户信息展示（昵称、头像、简介）
  - 发帖列表
  - 粉丝/关注列表
  - 用户统计（发帖数、关注数、粉丝数）

#### 5.1.2 内容模块
- **发帖功能**
  - 文本内容发布
  - 图片上传（支持多图）
  - 内容审核（自动/人工）
  
- **帖子列表**
  - 首页时间线（关注+推荐）
  - 个人发帖列表
  - 分页加载
  
- **帖子详情**
  - 帖子内容展示
  - 评论列表（分页）
  - 点赞功能

#### 5.1.3 社交模块
- **评论功能**
  - 评论发布
  - 回复评论（二级评论）
  - 评论点赞
  
- **点赞功能**
  - 帖子点赞/取消点赞
  - 评论点赞/取消点赞
  - 点赞计数更新
  
- **关注功能**
  - 关注/取消关注
  - 关注列表
  - 粉丝列表
  - 关注推荐

### 5.2 管理平台模块 (f1115-admin)

#### 5.2.1 用户管理
- **用户列表**
  - 用户信息查询
  - 用户状态管理（启用/禁用）
  - 用户删除
  
- **用户统计**
  - 用户总数
  - 活跃用户数
  - 新增用户趋势

#### 5.2.2 内容管理
- **帖子管理**
  - 帖子列表（分页、筛选）
  - 帖子删除
  - 帖子置顶
  - 违规内容标记
  
- **评论管理**
  - 评论列表
  - 评论删除
  - 违规评论标记

#### 5.2.3 审核管理
- **内容审核**
  - 待审核内容列表
  - 审核通过/拒绝
  - 审核历史记录
  
- **违规内容**
  - 违规内容统计
  - 违规用户标记

### 5.3 AI服务模块 (f1115-ai)

#### 5.3.1 AI内容生成
- **发帖生成**
  - 定时任务触发
  - 调用AI API生成内容
  - 自动发布到平台
  
- **评论生成**
  - 监控热门帖子
  - 自动生成相关评论
  - 自动发布评论

#### 5.3.2 内容审核
- **自动审核**
  - 文本内容分析
  - 违规关键词检测
  - 敏感内容识别
  
- **审核结果处理**
  - 自动标记违规内容
  - 通知管理员
  - 记录审核日志

---

## 6. API接口设计

### 6.1 接口规范
- **协议**: HTTP/HTTPS
- **数据格式**: JSON
- **请求方式**: RESTful
- **响应格式**: 统一Result包装

### 6.2 统一响应格式

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {},
  "total": 0
}
```

**响应码说明**:
- `200`: 成功
- `-1`: 业务失败
- `401`: 未登录
- `403`: 无权限
- `500`: 服务器错误

### 6.3 主平台API接口

#### 6.3.1 用户相关接口

```
POST   /api/user/register       # 用户注册
POST   /api/user/login          # 用户登录
POST   /api/user/logout         # 用户登出
GET    /api/user/profile        # 获取当前用户信息
PUT    /api/user/profile        # 更新用户信息
GET    /api/user/{userId}       # 获取指定用户信息
GET    /api/user/{userId}/posts # 获取用户发帖列表
GET    /api/user/{userId}/followers   # 获取粉丝列表
GET    /api/user/{userId}/following   # 获取关注列表
POST   /api/user/{userId}/follow      # 关注用户
DELETE /api/user/{userId}/follow      # 取消关注
```

#### 6.3.2 帖子相关接口

```
GET    /api/post/timeline       # 获取首页时间线（分页）
GET    /api/post/{postId}       # 获取帖子详情
POST   /api/post                # 发布帖子
DELETE /api/post/{postId}       # 删除帖子
POST   /api/post/{postId}/like  # 点赞/取消点赞帖子
```

#### 6.3.3 评论相关接口

```
GET    /api/post/{postId}/comments  # 获取帖子评论列表（分页）
POST   /api/post/{postId}/comment   # 发布评论
DELETE /api/comment/{commentId}     # 删除评论
POST   /api/comment/{commentId}/like # 点赞/取消点赞评论
```

### 6.4 管理平台API接口

```
# 用户管理
GET    /api/admin/users         # 获取用户列表（分页、筛选）
PUT    /api/admin/user/{userId}/status # 更新用户状态
DELETE /api/admin/user/{userId} # 删除用户

# 内容管理
GET    /api/admin/posts         # 获取帖子列表（分页、筛选）
DELETE /api/admin/post/{postId} # 删除帖子
PUT    /api/admin/post/{postId}/top # 置顶/取消置顶
GET    /api/admin/comments      # 获取评论列表
DELETE /api/admin/comment/{commentId} # 删除评论

# 审核管理
GET    /api/admin/audit/pending # 获取待审核内容
POST   /api/admin/audit/{id}/approve # 审核通过
POST   /api/admin/audit/{id}/reject  # 审核拒绝
```

### 6.5 AI服务API接口

```
# AI内容生成
POST   /api/ai/generate/post    # 生成帖子内容
POST   /api/ai/generate/comment # 生成评论内容

# 内容审核
POST   /api/ai/audit            # 内容审核
GET    /api/ai/audit/result     # 获取审核结果
```

---

## 7. 开发阶段规划

### 7.1 阶段一：基础框架搭建 (1-2周)

**目标**: 搭建项目基础架构，完成数据库设计和基础配置

**任务清单**:
- [ ] 创建Maven多模块项目结构
- [ ] 配置Spring、MyBatis、数据库连接
- [ ] 设计并创建数据库表结构
- [ ] 配置前后端分离开发环境
- [ ] 搭建统一响应格式、异常处理
- [ ] 配置日志系统（Log4j2）

**交付物**:
- 项目骨架代码
- 数据库表结构SQL
- 基础配置文件

**评估标准**:
- 项目能够正常启动
- 数据库连接正常
- 基础API测试通过

### 7.2 阶段二：用户系统开发 (2-3周)

**目标**: 完成用户注册、登录、个人主页等核心功能

**任务清单**:
- [ ] 用户注册功能（后端+前端）
- [ ] 用户登录功能（Session管理）
- [ ] 用户信息管理（查看、编辑）
- [ ] 个人主页展示
- [ ] 密码加密、验证码功能

**交付物**:
- 用户相关API接口
- 用户注册/登录页面
- 个人主页页面

**评估标准**:
- 用户能够成功注册和登录
- 个人主页信息展示正确
- Session管理正常

### 7.3 阶段三：内容系统开发 (3-4周)

**目标**: 完成发帖、帖子列表、帖子详情等核心功能

**任务清单**:
- [ ] 发帖功能（文本+图片）
- [ ] 图片上传功能
- [ ] 帖子列表（首页时间线）
- [ ] 帖子详情页
- [ ] 分页功能实现
- [ ] 帖子删除功能

**交付物**:
- 帖子相关API接口
- 发帖页面
- 帖子列表页面
- 帖子详情页面

**评估标准**:
- 用户能够成功发布帖子
- 帖子列表正确显示
- 图片上传功能正常

### 7.4 阶段四：社交功能开发 (2-3周)

**目标**: 完成评论、点赞、关注等社交功能

**任务清单**:
- [ ] 评论功能（一级、二级评论）
- [ ] 点赞功能（帖子、评论）
- [ ] 关注/取消关注功能
- [ ] 粉丝/关注列表
- [ ] 点赞数、评论数实时更新

**交付物**:
- 评论相关API接口
- 点赞相关API接口
- 关注相关API接口
- 社交功能前端页面

**评估标准**:
- 评论功能正常
- 点赞功能正常
- 关注关系正确建立

### 7.5 阶段五：管理后台开发 (2-3周)

**目标**: 基于现有CRM系统重构，实现管理功能

**任务清单**:
- [ ] 重构现有CRM系统结构
- [ ] 用户管理功能（列表、状态管理）
- [ ] 帖子管理功能（列表、删除、置顶）
- [ ] 评论管理功能（列表、删除）
- [ ] 管理后台前端页面

**交付物**:
- 管理后台API接口
- 管理后台前端页面
- 管理后台权限控制

**评估标准**:
- 管理员能够管理用户
- 管理员能够管理内容
- 权限控制正确

### 7.6 阶段六：AI功能集成 (3-4周)

**目标**: 集成AI服务，实现内容生成和审核

**任务清单**:
- [ ] AI API客户端封装
- [ ] AI内容生成服务（帖子、评论）
- [ ] 定时任务实现（AI定时发帖）
- [ ] 内容自动审核功能
- [ ] 审核结果处理
- [ ] AI机器人配置管理

**交付物**:
- AI服务模块
- AI定时任务
- 内容审核功能
- AI配置管理页面

**评估标准**:
- AI能够自动生成内容
- 定时任务正常运行
- 内容审核准确率达标

### 7.7 阶段七：测试与优化 (2周)

**目标**: 系统测试、性能优化、Bug修复

**任务清单**:
- [ ] 功能测试
- [ ] 性能测试
- [ ] 安全测试
- [ ] Bug修复
- [ ] 代码优化
- [ ] 文档完善

**交付物**:
- 测试报告
- 性能优化报告
- 用户手册

### 7.8 阶段八：部署上线 (1周)

**目标**: 项目部署到生产环境

**任务清单**:
- [ ] 服务器环境配置
- [ ] 数据库初始化
- [ ] 应用部署
- [ ] Nginx配置
- [ ] 域名配置
- [ ] 监控配置

**交付物**:
- 部署文档
- 运维手册

---

## 8. AI机器人集成方案

### 8.1 AI服务选择

**推荐方案**:
- **OpenAI API** (GPT-3.5/GPT-4): 内容生成、对话
- **Claude API** (Anthropic): 备选方案
- **国产AI服务**: 文心一言、通义千问等（可选）

**选择标准**:
- API稳定性
- 响应速度
- 成本控制
- 内容质量

### 8.2 AI内容生成流程

```
┌──────────────┐
│  定时任务触发 │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 获取热点话题  │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 调用AI API   │
│ 生成内容      │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 内容审核     │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 发布到平台   │
└──────────────┘
```

### 8.3 内容审核流程

```
┌──────────────┐
│ 用户发布内容  │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ AI自动审核   │
└──────┬───────┘
       │
       ├─── 通过 ───► 直接发布
       │
       ├─── 疑似违规 ───► 标记待审核
       │
       └─── 违规 ───► 拒绝发布，通知管理员
```

### 8.4 AI服务实现示例

**AI客户端封装**:
```java
@Service
public class AIService {
    
    @Autowired
    private AIConfig aiConfig;
    
    /**
     * 生成帖子内容
     */
    public String generatePost(String topic) {
        // 调用OpenAI API
        String prompt = "请生成一个关于" + topic + "的帖子内容，要求有趣且正能量。";
        // 实现API调用逻辑
        return callAIAPI(prompt);
    }
    
    /**
     * 内容审核
     */
    public AuditResult auditContent(String content) {
        String prompt = "请审核以下内容是否违规：" + content;
        // 实现审核逻辑
        return parseAuditResult(callAIAPI(prompt));
    }
}
```

**定时任务配置**:
```java
@Component
public class AIScheduler {
    
    @Autowired
    private AIService aiService;
    
    @Autowired
    private PostService postService;
    
    /**
     * AI定时发帖（每天上午10点和下午3点）
     */
    @Scheduled(cron = "0 0 10,15 * * ?")
    public void generateAIPost() {
        String topic = getHotTopic(); // 获取热点话题
        String content = aiService.generatePost(topic);
        postService.createPost(aiUserId, content, PostType.AI);
    }
}
```

---

## 9. 部署方案

### 9.1 服务器环境要求

**最低配置**:
- CPU: 2核
- 内存: 4GB
- 磁盘: 50GB
- 操作系统: Linux (CentOS 7+ / Ubuntu 20.04+)

**推荐配置**:
- CPU: 4核
- 内存: 8GB
- 磁盘: 100GB SSD
- 带宽: 5Mbps+

### 9.2 部署架构

```
                    Internet
                       │
                       ▼
                  ┌─────────┐
                  │  Nginx  │ (80/443)
                  └────┬────┘
                       │
          ┌────────────┼────────────┐
          │            │            │
      ┌───▼───┐   ┌───▼───┐   ┌───▼───┐
      │Tomcat1│   │Tomcat2│   │Tomcat3│
      └───┬───┘   └───┬───┘   └───┬───┘
          │            │            │
          └────────────┼────────────┘
                       │
                  ┌────▼────┐
                  │  MySQL  │
                  └─────────┘
```

### 9.3 部署步骤

1. **服务器准备**
   - 安装JDK 1.8+
   - 安装Tomcat 9.0+
   - 安装MySQL 8.0+
   - 安装Nginx

2. **数据库部署**
   - 创建数据库
   - 执行SQL脚本
   - 配置数据库用户权限

3. **应用部署**
   - Maven打包（WAR文件）
   - 上传WAR到Tomcat
   - 配置application.properties
   - 启动Tomcat

4. **Nginx配置**
   - 配置反向代理
   - 配置静态资源
   - 配置SSL证书（HTTPS）

5. **监控配置**
   - 应用监控（可选）
   - 日志收集（可选）

### 9.4 配置文件示例

**Nginx配置** (`/etc/nginx/conf.d/f1115.conf`):
```nginx
server {
    listen 80;
    server_name f1115.com;
    
    # 静态资源
    location /resources/ {
        alias /var/www/f1115/static/;
    }
    
    # 反向代理
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## 10. 技术细节与注意事项

### 10.0 技术选型与配置详解

#### 10.0.1 文件存储方案

**方案选择**:
- **开发环境**: 本地文件系统（推荐）
- **生产环境**: OSS对象存储（推荐）或本地文件系统

**本地文件系统配置**:

1. **Spring配置** (`springmvc.xml`):
```xml
<!-- 文件上传配置 -->
<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    <property name="maxUploadSize" value="10485760" /> <!-- 10MB -->
    <property name="maxInMemorySize" value="4096" />
    <property name="defaultEncoding" value="UTF-8" />
</bean>

<!-- 文件存储路径配置 -->
<bean id="uploadBean" class="com.form1115.crm.common.UploadBean">
    <property name="baseUrl" value="${upload.baseUrl:upload}" />
</bean>
```

2. **配置文件** (`db.properties`):
```properties
# 本地文件存储配置
upload.baseUrl=upload
upload.imagePath=upload/images
upload.maxFileSize=5242880
upload.allowedTypes=jpg,jpeg,png,gif,webp
```

3. **文件上传服务实现**:
```java
@Service
public class FileUploadService {
    
    @Autowired
    private UploadBean uploadBean;
    
    /**
     * 上传图片
     */
    public String uploadImage(MultipartFile file) throws IOException {
        // 验证文件类型
        String originalFilename = file.getOriginalFilename();
        String ext = originalFilename.substring(originalFilename.lastIndexOf("."));
        if (!isAllowedImageType(ext)) {
            throw new IllegalArgumentException("不支持的文件类型");
        }
        
        // 生成唯一文件名
        String fileName = UUID.randomUUID().toString() + ext;
        
        // 保存文件
        String savePath = uploadBean.getBaseUrl() + "/images";
        File dir = new File(savePath);
        if (!dir.exists()) {
            dir.mkdirs();
        }
        
        File targetFile = new File(dir, fileName);
        file.transferTo(targetFile);
        
        // 返回访问路径
        return "/resources/upload/images/" + fileName;
    }
}
```

**OSS对象存储配置** (推荐生产环境):

1. **添加依赖** (`pom.xml`):
```xml
<!-- 阿里云OSS -->
<dependency>
    <groupId>com.aliyun.oss</groupId>
    <artifactId>aliyun-sdk-oss</artifactId>
    <version>3.15.1</version>
</dependency>
```

2. **OSS配置** (`db.properties`):
```properties
# OSS配置
oss.endpoint=https://oss-cn-hangzhou.aliyuncs.com
oss.accessKeyId=your_access_key_id
oss.accessKeySecret=your_access_key_secret
oss.bucketName=f1115-bucket
oss.domain=https://f1115.oss-cn-hangzhou.aliyuncs.com
```

3. **OSS服务封装**:
```java
@Service
public class OSSUploadService {
    
    @Value("${oss.endpoint}")
    private String endpoint;
    
    @Value("${oss.accessKeyId}")
    private String accessKeyId;
    
    @Value("${oss.accessKeySecret}")
    private String accessKeySecret;
    
    @Value("${oss.bucketName}")
    private String bucketName;
    
    /**
     * 上传文件到OSS
     */
    public String uploadFile(MultipartFile file) throws Exception {
        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);
        
        String fileName = "images/" + UUID.randomUUID().toString() + 
                         file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf("."));
        
        ossClient.putObject(bucketName, fileName, file.getInputStream());
        ossClient.shutdown();
        
        return "https://" + bucketName + "." + endpoint + "/" + fileName;
    }
}
```

#### 10.0.2 Redis配置与使用场景

**Redis依赖配置** (`pom.xml`):
```xml
<!-- Spring Data Redis -->
<dependency>
    <groupId>org.springframework.data</groupId>
    <artifactId>spring-data-redis</artifactId>
    <version>2.6.2</version>
</dependency>
<!-- Lettuce连接池 -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-pool2</artifactId>
    <version>2.11.1</version>
</dependency>
```

**Redis配置** (`spring-context.xml`):
```xml
<!-- Redis配置 -->
<bean id="redisConnectionFactory" 
      class="org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory">
    <property name="hostName" value="${redis.host:localhost}" />
    <property name="port" value="${redis.port:6379}" />
    <property name="password" value="${redis.password:}" />
    <property name="database" value="${redis.database:0}" />
    <property name="poolConfig">
        <bean class="org.apache.commons.pool2.impl.GenericObjectPoolConfig">
            <property name="maxTotal" value="100" />
            <property name="maxIdle" value="20" />
            <property name="minIdle" value="5" />
        </bean>
    </property>
</bean>

<bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate">
    <property name="connectionFactory" ref="redisConnectionFactory" />
    <property name="keySerializer">
        <bean class="org.springframework.data.redis.serializer.StringRedisSerializer" />
    </property>
    <property name="valueSerializer">
        <bean class="org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer" />
    </property>
</bean>
```

**Redis配置文件** (`db.properties`):
```properties
# Redis配置
redis.host=localhost
redis.port=6379
redis.password=
redis.database=0
redis.timeout=3000
```

**Redis使用场景**:

1. **缓存热点数据**:
```java
@Service
public class PostCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String POST_CACHE_KEY = "post:";
    private static final long CACHE_EXPIRE = 3600; // 1小时
    
    /**
     * 缓存帖子详情
     */
    public void cachePost(Long postId, Post post) {
        String key = POST_CACHE_KEY + postId;
        redisTemplate.opsForValue().set(key, post, CACHE_EXPIRE, TimeUnit.SECONDS);
    }
    
    /**
     * 获取缓存的帖子
     */
    public Post getCachedPost(Long postId) {
        String key = POST_CACHE_KEY + postId;
        return (Post) redisTemplate.opsForValue().get(key);
    }
}
```

2. **点赞计数器**:
```java
@Service
public class LikeCountService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * 增加点赞数
     */
    public void incrementLikeCount(Long postId) {
        String key = "like:count:" + postId;
        redisTemplate.opsForValue().increment(key);
    }
    
    /**
     * 获取点赞数
     */
    public Long getLikeCount(Long postId) {
        String key = "like:count:" + postId;
        Object count = redisTemplate.opsForValue().get(key);
        return count != null ? Long.parseLong(count.toString()) : 0L;
    }
}
```

3. **Session存储** (可选):
```xml
<!-- Spring Session Redis -->
<dependency>
    <groupId>org.springframework.session</groupId>
    <artifactId>spring-session-data-redis</artifactId>
    <version>2.6.2</version>
</dependency>
```

#### 10.0.3 消息队列配置（AI任务）

**RabbitMQ配置** (推荐):

1. **依赖配置** (`pom.xml`):
```xml
<!-- Spring AMQP -->
<dependency>
    <groupId>org.springframework.amqp</groupId>
    <artifactId>spring-rabbit</artifactId>
    <version>2.4.0</version>
</dependency>
```

2. **RabbitMQ配置类**:
```java
@Configuration
@EnableRabbit
public class RabbitMQConfig {
    
    @Value("${rabbitmq.host}")
    private String host;
    
    @Value("${rabbitmq.port}")
    private int port;
    
    @Value("${rabbitmq.username}")
    private String username;
    
    @Value("${rabbitmq.password}")
    private String password;
    
    // AI任务队列
    public static final String AI_TASK_QUEUE = "ai.task.queue";
    public static final String AI_TASK_EXCHANGE = "ai.task.exchange";
    
    @Bean
    public ConnectionFactory connectionFactory() {
        CachingConnectionFactory factory = new CachingConnectionFactory();
        factory.setHost(host);
        factory.setPort(port);
        factory.setUsername(username);
        factory.setPassword(password);
        return factory;
    }
    
    @Bean
    public RabbitTemplate rabbitTemplate() {
        return new RabbitTemplate(connectionFactory());
    }
    
    @Bean
    public Queue aiTaskQueue() {
        return new Queue(AI_TASK_QUEUE, true);
    }
    
    @Bean
    public DirectExchange aiTaskExchange() {
        return new DirectExchange(AI_TASK_EXCHANGE);
    }
    
    @Bean
    public Binding aiTaskBinding() {
        return BindingBuilder.bind(aiTaskQueue()).to(aiTaskExchange()).with(AI_TASK_QUEUE);
    }
}
```

3. **配置文件** (`db.properties`):
```properties
# RabbitMQ配置
rabbitmq.host=localhost
rabbitmq.port=5672
rabbitmq.username=guest
rabbitmq.password=guest
```

4. **消息生产者（发送AI任务）**:
```java
@Service
public class AITaskProducer {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    /**
     * 发送AI生成帖子任务
     */
    public void sendGeneratePostTask(String topic) {
        Map<String, Object> task = new HashMap<>();
        task.put("type", "generate_post");
        task.put("topic", topic);
        task.put("timestamp", System.currentTimeMillis());
        
        rabbitTemplate.convertAndSend(RabbitMQConfig.AI_TASK_EXCHANGE, 
                                     RabbitMQConfig.AI_TASK_QUEUE, task);
    }
}
```

5. **消息消费者（处理AI任务）**:
```java
@Component
public class AITaskConsumer {
    
    @Autowired
    private AIService aiService;
    
    @Autowired
    private PostService postService;
    
    @RabbitListener(queues = RabbitMQConfig.AI_TASK_QUEUE)
    public void handleAITask(Map<String, Object> task) {
        String type = (String) task.get("type");
        
        if ("generate_post".equals(type)) {
            String topic = (String) task.get("topic");
            String content = aiService.generatePost(topic);
            postService.createPost(aiUserId, content, PostType.AI);
        }
    }
}
```

#### 10.0.4 定时任务配置（Spring Scheduled）

**启用定时任务** (`spring-context.xml`):
```xml
<!-- 启用定时任务 -->
<task:annotation-driven scheduler="taskScheduler" />
<task:scheduler id="taskScheduler" pool-size="10" />
```

**或使用Java配置**:
```java
@Configuration
@EnableScheduling
public class ScheduleConfig {
    
    @Bean
    public TaskScheduler taskScheduler() {
        ThreadPoolTaskScheduler scheduler = new ThreadPoolTaskScheduler();
        scheduler.setPoolSize(10);
        scheduler.setThreadNamePrefix("scheduled-");
        scheduler.setWaitForTasksToCompleteOnShutdown(true);
        scheduler.setAwaitTerminationSeconds(60);
        return scheduler;
    }
}
```

**定时任务实现示例**:
```java
@Component
public class AIScheduledTasks {
    
    @Autowired
    private AIService aiService;
    
    @Autowired
    private PostService postService;
    
    /**
     * AI定时发帖 - 每天上午10点和下午3点执行
     */
    @Scheduled(cron = "0 0 10,15 * * ?")
    public void generateAIPost() {
        try {
            // 获取热点话题
            String topic = getHotTopic();
            
            // 调用AI生成内容
            String content = aiService.generatePost(topic);
            
            // 发布帖子
            postService.createPost(aiUserId, content, PostType.AI);
            
            log.info("AI定时发帖成功，话题：{}", topic);
        } catch (Exception e) {
            log.error("AI定时发帖失败", e);
        }
    }
    
    /**
     * AI定时评论 - 每小时执行一次
     */
    @Scheduled(cron = "0 0 * * * ?")
    public void generateAIComment() {
        try {
            // 获取热门帖子
            List<Post> hotPosts = postService.getHotPosts(10);
            
            for (Post post : hotPosts) {
                // 生成评论
                String comment = aiService.generateComment(post.getContent());
                
                // 发布评论
                commentService.createComment(post.getId(), aiUserId, comment, CommentType.AI);
            }
            
            log.info("AI定时评论成功，处理帖子数：{}", hotPosts.size());
        } catch (Exception e) {
            log.error("AI定时评论失败", e);
        }
    }
    
    /**
     * Cron表达式说明：
     * 秒 分 时 日 月 周
     * 0 0 10,15 * * ?  - 每天10点和15点执行
     * 0 0 * * * ?      - 每小时执行
     * 0 0/30 * * * ?   - 每30分钟执行
     * 0 0 0 * * ?      - 每天凌晨执行
     */
}
```

#### 10.0.5 WebSocket实时通知实现

**WebSocket依赖** (`pom.xml`):
```xml
<!-- Spring WebSocket -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-websocket</artifactId>
    <version>5.3.4</version>
</dependency>
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-messaging</artifactId>
    <version>5.3.4</version>
</dependency>
```

**WebSocket配置类**:
```java
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {
    
    /**
     * 注册STOMP端点
     */
    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/ws")
                .setAllowedOriginPatterns("*")
                .withSockJS();
    }
    
    /**
     * 配置消息代理
     */
    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        // 启用简单的内存消息代理
        config.enableSimpleBroker("/topic", "/queue");
        // 客户端发送消息的前缀
        config.setApplicationDestinationPrefixes("/app");
    }
}
```

**WebSocket处理器**:
```java
@Component
public class NotificationHandler {
    
    @Autowired
    private SimpMessagingTemplate messagingTemplate;
    
    /**
     * 发送点赞通知
     */
    public void sendLikeNotification(Long userId, Long postId) {
        NotificationMessage message = new NotificationMessage();
        message.setType("like");
        message.setContent("有人点赞了你的帖子");
        message.setPostId(postId);
        message.setTimestamp(new Date());
        
        // 发送给特定用户
        messagingTemplate.convertAndSend("/topic/user/" + userId, message);
    }
    
    /**
     * 发送评论通知
     */
    public void sendCommentNotification(Long userId, Long postId, Long commentId) {
        NotificationMessage message = new NotificationMessage();
        message.setType("comment");
        message.setContent("有人评论了你的帖子");
        message.setPostId(postId);
        message.setCommentId(commentId);
        message.setTimestamp(new Date());
        
        messagingTemplate.convertAndSend("/topic/user/" + userId, message);
    }
}
```

**前端WebSocket连接** (JavaScript):
```javascript
// 建立WebSocket连接
const socket = new SockJS('/ws');
const stompClient = Stomp.over(socket);

stompClient.connect({}, function(frame) {
    console.log('WebSocket连接成功');
    
    // 订阅用户通知
    const userId = getCurrentUserId();
    stompClient.subscribe('/topic/user/' + userId, function(message) {
        const notification = JSON.parse(message.body);
        showNotification(notification);
    });
});

// 断开连接
function disconnect() {
    if (stompClient !== null) {
        stompClient.disconnect();
    }
}
```

#### 10.0.6 全文搜索配置（Elasticsearch）

**Elasticsearch依赖** (`pom.xml`):
```xml
<!-- Elasticsearch -->
<dependency>
    <groupId>org.springframework.data</groupId>
    <artifactId>spring-data-elasticsearch</artifactId>
    <version>4.3.0</version>
</dependency>
```

**Elasticsearch配置类**:
```java
@Configuration
@EnableElasticsearchRepositories(basePackages = "com.form1115.f1115.repository")
public class ElasticsearchConfig extends AbstractElasticsearchConfiguration {
    
    @Value("${elasticsearch.host}")
    private String host;
    
    @Value("${elasticsearch.port}")
    private int port;
    
    @Override
    @Bean
    public RestHighLevelClient elasticsearchClient() {
        ClientConfiguration clientConfiguration = ClientConfiguration.builder()
            .connectedTo(host + ":" + port)
            .build();
        
        return RestClients.create(clientConfiguration).rest();
    }
}
```

**配置文件** (`db.properties`):
```properties
# Elasticsearch配置
elasticsearch.host=localhost
elasticsearch.port=9200
elasticsearch.index.post=post_index
```

**实体映射**:
```java
@Document(indexName = "post_index")
public class PostDocument {
    
    @Id
    private Long id;
    
    @Field(type = FieldType.Text, analyzer = "ik_max_word")
    private String content;
    
    @Field(type = FieldType.Long)
    private Long userId;
    
    @Field(type = FieldType.Date)
    private Date createTime;
    
    // getter/setter...
}
```

**索引初始化**:
```java
@Service
public class ElasticsearchService {
    
    @Autowired
    private ElasticsearchRestTemplate elasticsearchTemplate;
    
    /**
     * 创建索引
     */
    public void createIndex() {
        if (!elasticsearchTemplate.indexOps(PostDocument.class).exists()) {
            elasticsearchTemplate.indexOps(PostDocument.class).create();
            // 设置映射
            elasticsearchTemplate.indexOps(PostDocument.class).putMapping();
        }
    }
    
    /**
     * 添加帖子到索引
     */
    public void indexPost(Post post) {
        PostDocument document = convertToDocument(post);
        elasticsearchTemplate.save(document);
    }
    
    /**
     * 搜索帖子
     */
    public List<PostDocument> searchPosts(String keyword, int pageNum, int pageSize) {
        NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder();
        
        // 多字段搜索
        queryBuilder.withQuery(QueryBuilders.multiMatchQuery(keyword, "content"));
        
        // 分页
        queryBuilder.withPageable(PageRequest.of(pageNum - 1, pageSize));
        
        // 高亮
        queryBuilder.withHighlightFields(new HighlightBuilder.Field("content"));
        
        SearchHits<PostDocument> searchHits = elasticsearchTemplate.search(
            queryBuilder.build(), PostDocument.class);
        
        return searchHits.stream()
            .map(SearchHit::getContent)
            .collect(Collectors.toList());
    }
}
```

**搜索接口实现**:
```java
@RestController
@RequestMapping("/api/search")
public class SearchController {
    
    @Autowired
    private ElasticsearchService elasticsearchService;
    
    @GetMapping("/posts")
    public Result searchPosts(@RequestParam String keyword,
                             @RequestParam(defaultValue = "1") Integer pageNum,
                             @RequestParam(defaultValue = "10") Integer pageSize) {
        List<PostDocument> posts = elasticsearchService.searchPosts(keyword, pageNum, pageSize);
        return new Result().setData(posts);
    }
}
```

---

## 10. 技术细节与注意事项

### 10.1 开发环境说明

**VSCode开发**:
- 主要用于Java代码编写（AI辅助）
- 安装Java扩展包
- 使用Maven插件进行构建

**IDEA操作**:
以下操作建议在IDEA中进行：
- **Maven项目导入**: IDEA的Maven支持更好
- **数据库连接**: 使用IDEA的Database工具
- **调试**: IDEA的调试功能更强大
- **Git操作**: IDEA的Git集成更好

### 10.2 关键技术实现

#### 10.2.1 图片上传
- **前端**: FormData + Axios
- **后端**: MultipartFile接收
- **存储**: 本地文件系统或OSS
- **限制**: 文件大小、文件类型

#### 10.2.2 分页实现
- **后端**: PageHelper插件
- **前端**: Element UI Pagination组件
- **优化**: 大数据量使用游标分页

#### 10.2.3 点赞功能
- **实现**: Redis计数器（可选）+ 数据库存储
- **防重复**: 数据库唯一索引
- **实时更新**: 前端轮询或WebSocket

#### 10.2.4 关注功能
- **关系存储**: 关注关系表
- **统计**: 实时计算或缓存
- **推荐算法**: 基于关注关系的推荐（可选）

### 10.3 安全注意事项

1. **密码安全**
   - MD5加密（可升级为BCrypt）
   - 密码强度验证
   - 防止SQL注入（使用MyBatis参数化查询）

2. **XSS防护**
   - 前端输入验证
   - 后端内容转义
   - 使用富文本编辑器（XSS过滤）

3. **CSRF防护**
   - Token验证
   - SameSite Cookie

4. **API安全**
   - 接口权限验证
   - 频率限制（防止刷接口）
   - 敏感操作二次验证

### 10.4 性能优化建议

1. **数据库优化**
   - 合理使用索引
   - 避免N+1查询
   - 分页查询优化

2. **缓存策略**
   - 热点数据缓存（Redis）
   - 静态资源CDN
   - 图片懒加载

3. **前端优化**
   - 代码压缩
   - 图片压缩
   - 路由懒加载

### 10.5 可选功能扩展

1. **实时通知**
   - WebSocket实现
   - 点赞、评论通知

2. **全文搜索**
   - Elasticsearch集成
   - 帖子内容搜索

3. **推荐系统**
   - 基于内容的推荐
   - 协同过滤算法

4. **数据分析**
   - 用户行为分析
   - 内容热度统计
   - 数据可视化

---

## 11. 项目进度评估标准

### 11.1 各阶段完成标准

| 阶段 | 完成标准 | 检查点 | 状态 |
|------|---------|--------|------|
| 阶段一 | 项目能正常启动，数据库连接正常 | 运行测试接口 | ✅ 已完成 |
| 阶段二 | 用户能注册登录，个人主页正常 | 完成用户功能测试 | ✅ 已完成 |
| 阶段三 | 能发布帖子，列表正常显示 | 完成内容功能测试 | ✅ 已完成 |
| 阶段3.5 | 个人主页完善，支持编辑和跳转 | 完成主页功能测试 | ✅ 已完成 |
| 阶段四 | 评论点赞关注功能正常 | 完成社交功能测试 | ✅ 已完成 |
| 阶段五 | 管理后台能管理用户和内容 | 完成管理功能测试 | ✅ 已完成 |
| 阶段六 | AI能生成内容和审核 | 完成AI功能测试 | ✅ 已完成 |
| AI增强 | AI自动评论和智能回复 | 完成AI交互测试 | ✅ 已完成 |
| 阶段七 | 无严重Bug，性能达标 | 测试报告通过 | ⏳ 待开发 |
| 阶段八 | 生产环境正常运行 | 上线验证通过 | ⏳ 待开发 |

### 11.2 代码质量要求

- **代码规范**: 遵循Java代码规范
- **注释**: 关键方法必须有注释
- **异常处理**: 完善的异常处理机制
- **日志记录**: 关键操作记录日志

### 11.3 测试要求

- **单元测试**: 核心业务逻辑有单元测试（可选）
- **接口测试**: 所有API接口测试通过
- **功能测试**: 所有功能点测试通过
- **性能测试**: 响应时间、并发能力达标

---

## 12. 附录

### 12.1 参考资料

- Spring Framework官方文档
- MyBatis官方文档
- Vue.js官方文档
- Element UI官方文档
- OpenAI API文档

### 12.2 常用命令

**Maven构建**:
```bash
mvn clean package  # 打包
mvn clean install  # 安装到本地仓库
```

**数据库操作**:
```sql
-- 查看表结构
SHOW CREATE TABLE user_profile;

-- 查看索引
SHOW INDEX FROM user_profile;
```

### 12.3 问题排查

**常见问题**:
1. **数据库连接失败**: 检查配置文件、防火墙、数据库服务
2. **端口占用**: 检查Tomcat端口是否被占用
3. **跨域问题**: 配置CORS
4. **Session丢失**: 检查Session配置、Cookie设置

---

## 文档更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|---------|--------|
| v1.0 | 2026-01-16 | 初始版本 | AI Assistant |
| v1.1 | 2026-01-16 | 补充技术细节：文件存储、Redis、消息队列、定时任务、WebSocket、Elasticsearch | AI Assistant |
| v1.2 | 2026-01-17 | 更新项目进度：阶段一、二、三、3.5已完成，完成度55% | AI Assistant |
| v1.3 | 2026-01-17 | 更新项目进度：阶段四、六已完成，完成度80% | AI Assistant |
| v1.4 | 2026-01-17 | 更新项目进度：阶段五已完成，AI评论功能完成，完成度90% | AI Assistant |
| v1.4 | 2026-01-17 | 更新项目进度：阶段五已完成，AI评论功能完成，完成度90% | AI Assistant |

---

## 13. AI视觉模型使用说明

### 13.1 视觉模型介绍

F1115平台集成了通义千问视觉模型（qwen-vl-plus），可以理解图片内容。

### 13.2 使用条件

**重要**：视觉模型需要图片URL是公网可访问的地址。

#### 开发环境（localhost）
- ❌ **无法使用视觉模型**
- 原因：localhost图片AI服务器无法访问
- 解决：使用文本模型，在提示词中说明包含图片

#### 生产环境（公网部署）
- ✅ **可以使用视觉模型**
- 条件：图片部署到公网可访问的服务器
- 方案：
  1. 使用云存储（阿里云OSS、腾讯云COS）
  2. 部署到公网服务器
  3. 配置CDN加速

### 13.3 启用视觉模型

当图片部署到公网后，修改 `AICommentService.java`：

```java
// 恢复视觉模型代码
private String generateCommentWithVisionModel(String postContent, List<String> imageList) throws Exception {
    MultiModalConversation conv = new MultiModalConversation();
    
    List<Map<String, Object>> content = new ArrayList<>();
    
    // 添加图片（确保是公网URL）
    if (imageList != null && !imageList.isEmpty()) {
        String firstImage = imageList.get(0);
        // 使用公网URL，例如：https://your-domain.com/upload/images/xxx.jpg
        content.add(Collections.singletonMap("image", firstImage));
    }
    
    // 添加文本
    content.add(Collections.singletonMap("text", "请生成评论..."));
    
    // 使用视觉模型
    MultiModalConversationParam param = MultiModalConversationParam.builder()
        .apiKey(apiKey)
        .model("qwen-vl-plus")  // 视觉模型
        .messages(Arrays.asList(userMessage))
        .build();
    
    MultiModalConversationResult result = conv.call(param);
    return result.getOutput().getChoices().get(0).getMessage().getContent().get(0).get("text").toString();
}
```

### 13.4 当前实现

**开发环境降级方案**：
- 使用文本模型（qwen-flash）
- 在提示词中说明帖子包含图片
- AI仍能生成相关评论
- 只是无法"看到"图片内容

**优点**：
- 开发环境可以正常测试
- 不需要公网部署
- 功能完整可用

**生产环境升级**：
- 部署图片到云存储
- 启用视觉模型
- AI可以真正理解图片

---

## 14. 微博Cookie配置说明

### 14.1 配置目的

**微博Cookie配置用于AI定时任务获取热搜话题**。

- AI定时发帖功能会尝试从微博热搜获取话题
- 如果Cookie未配置或获取失败，会自动使用备用话题列表
- 不影响AI发帖功能，只是话题来源不同

### 14.2 配置方法

#### 方法1: 使用环境变量（推荐）

**Windows系统**：
1. 右键"此电脑" -> 属性 -> 高级系统设置 -> 环境变量
2. 新建系统变量：
   - 变量名：`WEIBO_SUB_COOKIE`
   - 变量值：你的SUB Cookie值
3. 新建系统变量：
   - 变量名：`WEIBO_SUBP_COOKIE`
   - 变量值：你的SUBP Cookie值
4. 重启IDEA和Tomcat

**Linux/Mac系统**：
在 `~/.bashrc` 或 `~/.zshrc` 中添加：
```bash
export WEIBO_SUB_COOKIE="your_sub_cookie_value"
export WEIBO_SUBP_COOKIE="your_subp_cookie_value"
```

#### 方法2: 修改代码（仅用于本地测试）

在 `AIScheduler.java` 的 `fetchWeiboHotSearch()` 方法中，替换占位符为实际Cookie值：

```java
if (SUB == null || SUB.isEmpty()) {
    SUB = "你的实际SUB Cookie值";
}
if (SUBP == null || SUBP.isEmpty()) {
    SUBP = "你的实际SUBP Cookie值";
}
```

**⚠️ 重要**：修改后不要提交到Git！

### 14.3 如何获取微博Cookie

1. 打开浏览器，访问 https://weibo.com
2. 登录你的微博账号
3. 按F12打开开发者工具
4. 切换到 `Application` 或 `存储` 标签
5. 左侧选择 `Cookies` -> `https://weibo.com`
6. 找到并复制：
   - `SUB` 的值
   - `SUBP` 的值

### 14.4 降级策略

如果Cookie未配置或获取失败：
- ✅ 自动使用12个备用话题（科技发展、生活感悟、学习心得等）
- ✅ 不影响AI发帖功能
- ✅ 定时任务正常执行

### 14.5 注意事项

1. **Cookie有效期**：微博Cookie会过期，需要定期更新
2. **反爬虫**：微博有反爬虫机制，不要频繁请求（当前设置：每小时1次）
3. **安全性**：Cookie包含敏感信息，不应该硬编码在代码中

**详细说明**：详见项目根目录下的 `WEIBO_COOKIE_CONFIG.md`

---

**文档结束**

如有疑问或需要补充，请及时更新文档。
