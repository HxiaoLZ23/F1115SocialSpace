# AI审核功能测试指南

## 🎯 功能说明

AI审核已集成到发帖流程中，每次用户发帖时会自动进行内容审核。

### 审核流程

```
用户发帖
    ↓
AI自动审核
    ↓
├─ 通过 → 帖子正常发布（status=1）
├─ 拒绝 → 提示用户，不允许发布
└─ 待审核 → 帖子进入审核状态（status=2）
```

---

## 🧪 测试方法

### 测试1: 正常内容（应该通过）

1. **登录系统**
2. **在首页发帖框输入**：
   ```
   今天天气真好，分享一下美好的心情！
   ```
3. **点击发布**
4. **期望结果**：
   - 提示"发布成功"
   - 帖子正常显示在列表中
   - 后端日志显示：`帖子审核结果 - 状态:0, 原因:审核通过`

### 测试2: 违规内容（应该拒绝）

1. **在发帖框输入违规内容**（例如）：
   ```
   这是一条包含广告的内容，请加微信xxxxx购买产品
   ```
2. **点击发布**
3. **期望结果**：
   - 提示"内容审核未通过：..."
   - 帖子不会发布
   - 后端日志显示：`帖子审核结果 - 状态:1, 原因:拒绝...`

### 测试3: 模糊内容（可能待审核）

1. **输入模糊内容**：
   ```
   这是一条测试内容
   ```
2. **点击发布**
3. **期望结果**：
   - 可能通过，也可能待审核
   - 查看后端日志确认审核结果

---

## 📊 查看审核日志

### 在IDEA控制台查看

发帖时会显示审核日志：

```
INFO  PostService - 帖子审核结果 - 用户ID:3, 状态:0, 原因:审核通过
INFO  PostService - 帖子审核结果 - 用户ID:4, 状态:1, 原因:拒绝，内容包含广告信息
INFO  PostService - 帖子审核结果 - 用户ID:5, 状态:2, 原因:待人工审核
```

### 审核状态说明

| 状态 | 含义 | 结果 |
|------|------|------|
| 0 | 通过 | 帖子正常发布 |
| 1 | 拒绝 | 不允许发布，提示用户 |
| 2 | 待审核 | 需要人工审核（当前简化为通过） |

---

## 🔍 测试不同类型的内容

### 正常内容（应该通过）

```
✅ "今天学习了Vue 3，感觉很棒！"
✅ "分享一张美丽的风景照片"
✅ "推荐一本好书：《活着》"
✅ "周末去爬山，心情愉快"
```

### 可疑内容（可能拒绝）

```
❌ "加微信xxxxx，免费领取礼品"
❌ "点击链接下载破解软件"
❌ "包含敏感政治词汇的内容"
❌ "包含谩骂侮辱的内容"
```

### 模糊内容（可能待审核）

```
⚠️ "这是一条测试"
⚠️ "123456"
⚠️ "..."
```

---

## 🎨 审核规则

### AI审核标准

AI会检测以下违规内容：
- 色情低俗内容
- 暴力血腥内容
- 政治敏感内容
- 广告营销内容
- 谩骂侮辱内容
- 垃圾信息

### 审核提示词

当前使用的审核提示词：
```
你是一个内容审核员，请判断内容是否违规（包括：色情、暴力、政治敏感、广告、谩骂等）。
只需回答：通过、拒绝、待审核。如果拒绝，请简要说明原因。
```

---

## 🔧 自定义审核规则

### 修改审核严格程度

在 `PostService.java` 的 `auditContent()` 方法中修改提示词：

#### 更严格的审核
```java
.content("你是一个严格的内容审核员，请仔细检查内容是否违规..." +
        "对可疑内容标记为待审核。")
```

#### 更宽松的审核
```java
.content("你是一个宽松的内容审核员，只拒绝明显违规的内容...")
```

### 禁用AI审核

如果暂时不需要AI审核，注释掉审核代码：

```java
// AI内容审核
// if (!userId.equals(2L)) {
//     AuditResult auditResult = auditContent(content);
//     ...
// }
```

---

## 📝 完整测试流程

### 步骤1: 重启Tomcat
加载新的审核代码

### 步骤2: 测试正常内容
1. 登录系统
2. 发布："今天天气真好"
3. 应该成功发布

### 步骤3: 测试违规内容
1. 发布："加微信xxxxx购买产品"
2. 应该被拒绝，显示错误提示

### 步骤4: 查看日志
在IDEA控制台查看审核日志

### 步骤5: 验证数据库
```sql
-- 查看帖子状态
SELECT id, user_id, content, status, type FROM post ORDER BY create_time DESC LIMIT 10;

-- status=1: 正常发布
-- status=2: 审核中
-- status=3: 违规
```

---

## 💡 测试建议

### 快速测试多种内容

```javascript
// 在浏览器Console中执行
async function testAudit() {
  const contents = [
    "今天天气真好！",  // 应该通过
    "加微信xxxxx",     // 应该拒绝
    "分享一本好书"     // 应该通过
  ];
  
  for(let content of contents) {
    console.log(`测试内容: "${content}"`);
    try {
      const res = await fetch('http://localhost:8080/api/post', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        credentials: 'include',
        body: JSON.stringify({content, images: []})
      }).then(r => r.json());
      
      console.log(`结果: ${res.msg}`);
    } catch(e) {
      console.log(`错误: ${e.message}`);
    }
    await new Promise(r => setTimeout(r, 2000));
  }
}

testAudit();
```

---

## ⚠️ 注意事项

### 1. AI审核准确性

- AI审核不是100%准确
- 建议配合人工审核
- 可以设置敏感词黑名单

### 2. API调用成本

- 每次发帖都会调用AI API
- 注意API调用次数限制
- 可以考虑缓存审核结果

### 3. 降级策略

如果AI审核失败：
- 当前策略：默认通过（避免影响用户）
- 可以改为：默认待审核（更安全）

---

## 🎯 审核效果

### 成功案例

```
✅ 用户发帖："今天学习了Spring框架"
   → AI审核：通过
   → 结果：帖子正常发布

❌ 用户发帖："加微信xxxxx购买产品"
   → AI审核：拒绝，包含广告信息
   → 结果：发布失败，提示用户

⚠️ 用户发帖："测试"
   → AI审核：待审核
   → 结果：需要人工审核（当前简化为通过）
```

---

**AI审核已集成！重启Tomcat后开始测试！🚀**

---

**文档创建日期**: 2026-01-17  
**AI模型**: 通义千问 qwen-flash
